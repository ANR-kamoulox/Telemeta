{% extends "telemeta/base.html" %}
{% load telemeta_utils %}
{% load i18n %}

{% block extra_javascript %}
<script src="{% url telemeta-timeside "src/playlist.js" %}" type="text/javascript"></script>
<script>
    jQuery(document).ready(function(){
        $('#_new_playlist').bind("click.bla",function(e){var p = popup;
            return p.show(p.createDivDialog({'title':'','description':''}, function(data){playlistUtils.add(data)}),e);
        });
    });
</script>
{% endblock %}


{% block content %}

<div class="module-set">

{% block modules %}

   <div id="module" class="module">
    <h3><a href="{% url telemeta-rss %}">
      <img src="{% url telemeta-images "rss.png" %}" style="vertical-align:middle" /></a>
      {% trans "Last changes" %}</h3>
    <table class="listing" bgcolor="#FFFFFF" width="390px">
      <tr>
        <th class="highlight">{% trans "Date" %}</th>
        <th>{% trans "Title" %}</th>
        <th>{% trans "Type" %}</th>
        <th>{% trans "User" %}</th>
      </tr>
    {% for r in revisions %}
     <tr {% if not forloop.counter0|divisibleby:"2" %}class="odd"{% endif %}>
        <td>{{ r.revision.time }}</td>
        <td>
        {% if r.revision.element_type == "collection" and r.element %}
          <a href="{% url telemeta-collection-detail r.element.public_id %}">{{ r.element.title }}</a>
        {% endif %}
        {% if r.revision.element_type == "item" and r.element %}
          <a href="{% url telemeta-item-detail r.element.public_id %}">
           {% if r.element.title != '' %}{{ r.element.title }}{% else %}{{ r.element.public_id }}{% endif %}</a>
        {% endif %}
        {% if r.revision.element_type == "marker" and r.element %}
          <a href="{% url telemeta-item-detail-marker r.element.public_id %}">{{ r.element.title }}</a>
        {% endif %}
        </td>
        <td>{{ r.revision.element_type }}</td>
        <td>{% if r.revision.user %}<a href="{% url telemeta-profile-detail r.revision.user.username %}">{{ r.revision.user.username }}</a>{% endif %}</td>
        
     </tr>
    {% endfor %}
    </table>
   </div>

{% endblock %}
</div>

<div class="home-description">
<h3>{% trans "Playlists" %}</h3>
<a href=# id="_new_playlist" style="float:right" class="component_icon button icon_add">
{% trans "Add" %}</a>
  {% for playlist in playlists %}
  <!--<div>-->
  <!--<h2>{{ playlist.playlist.title }}</h2>-->
  <table class="listing" style="width:90%;margin-top: 3em">
      <tr>
          <td style="border-bottom:1px solid #6A0307;color:#6A0307;font-size: 100%">{{ playlist.playlist.title }}</td>
          <td style="width:33ex; padding-right: 0; border-bottom:1px solid #6A0307; text-align:right">
            <a href="{% url telemeta-playlist-csv-export playlist.playlist.public_id %}" class="component_icon button icon_csv">CSV</a>
            <a href="#" id="{{playlist.playlist.public_id}}" onclick="playlist.remove(this.id);return false;" class="component_icon button icon_cancel">{% trans "Delete" %}</a>
          </td>
      </tr>
  </table>
  
  
  <!--</div>-->
    <table class="listing" width="90%">
        <tr>
            <th class="highlight">{% trans "Title" %}</th>
            <th>{% trans "Type" %}</th>
            <th>{% trans "Code" %}</th>
            <th>{% trans "Recordist" %}</th>
            <th>{% trans "Year of recording" %}</th>
            <th>{% trans "Sound" %}</th>
            <th>{% trans "Action" %}</th>
        </tr>
        
        {% for resource in playlist.resources %}
        <tr {% if not forloop.counter0|divisibleby:"2" %}class="odd"{% endif %}>
            <td>
            {% if resource.type == "item" %}
             <a href="{% url telemeta-item-detail resource.element.public_id %}">{{ resource.element }}</a>
            {% endif %}
            {% if resource.type == "collection" %}
             <a href="{% url telemeta-collection-detail resource.element.public_id %}">{{ resource.element }}</a>
            {% endif %}
            {% if resource.type == "marker" %}
             <a href="{% url telemeta-item-detail-marker resource.element.public_id %}">{{ resource.element }}</a>
            {% endif %}
            </td>
            <td>{{ resource.type }}</td>
            <td>
                {{ resource.element.public_id }}
            </td>
            <td>{{ resource.element.apparent_collector }}</td>
           
            <td>
            {% if resource.element.recorded_from_date %}
                {{ resource.element.recorded_from_date.year }}
                {% if resource.element.recorded_to_date and not resource.element.recorded_to_date.year|equals:resource.element.recorded_from_date.year %}
                    - {{ resource.element.recorded_to_date.year }}
                {% endif %}
            {% endif %}
            </td>
            <td align="center" style="vertical-align:middle">
                {% if resource.element.file or resource.element.has_mediafile %}
                  <img src="images/ok.png" alt="yes" style="vertical-align:middle" /></a>
                {% endif %}
            </td>
            <td style="vertical-align:middle">
            <a href="#" onclick="playlistUtils.removeResource('{{resource.public_id}}');return false;" class="component_icon button icon_cancel" style="padding: 4px 12px;"></a>
            </td>
        </tr>
    {% endfor %}
    </table>
   {% endfor %}
</div>

{% endblock %}

